---
title: "[Project #1] Spring Boot + JWT Token"
date: "2021-01-24T23:15:32.169Z"
description: "[Project #1] Spring Boot + JWT Token (Maven, jjwt)"
path: "/Portfolio/pjt/everywherescrap/3/"
category: "Portfolio"
ci: "EWS"
cat: "PJT"
tags: ["PJT", "Spring Boot", "Java", "Jwt", "Security" ]
---



###### Project #1 Everywhere Scrap

#### Spring Boot + JWT Token

<hr />

##### Security - JWT Token 

 토큰으로 로그인을 진행하기 위해 jwt token을 활용한 방법을 쓰게 되었다.



##### 과정

1. Maven Dependency 추가

   ```xml
   <!-- 토큰 -->
   <dependency>
       <groupId>io.jsonwebtoken</groupId>
       <artifactId>jjwt</artifactId>
       <version>0.9.0</version>
   </dependency>
   ```

2. Security/JwtAuthentication.java

   * Bearer 방식으로 토큰 만들기

   ```java
   package com.example.backend.security;
   
   public class JwtAuthentication {
       private String accessToken;
       private String tokenType = "Bearer";
   
       public JwtAuthentication(String accessToken) {
           this.accessToken = accessToken;
       }
   
       public String getAccessToken() {
           return accessToken;
       }
   
       public void setAccessToken(String accessToken) {
           this.accessToken = accessToken;
       }
   
       public String getTokenType() {
           return tokenType;
       }
   
       public void setTokenType(String tokenType) {
           this.tokenType = tokenType;
       }
   
   }
   ```

3. Security/JwtTokenProvider.java

   * 먼저 Token을 생성하는 것과 Token으로 조회하는 코드 두개가 필요했다.

   ```java
   
   import io.jsonwebtoken.*;
   import java.util.Date;
   import org.springframework.beans.factory.annotation.Value;
   import org.springframework.stereotype.Component;
   
   import com.example.backend.model.user.User;
   
   @Component
   public class JwtTokenProvider {
       
       @Value("${jwt.secretkey}")	// application.properties에 jwt.secreatKey= 로 저장
       private String jwtSecretKey; 
   
       private Long jwtExpmin = 1000 * 60L * 60L * 2L; // 2시간
       
       // JWT Token 생성
       public String createToken(User user) {
           Claims claims = Jwts.claims().setSubject(user.getUid());
           claims.put("user", user);
   
           Date now = new Date();
   
           return Jwts.builder()
               .setClaims(claims) // 클레임 설정
               .setSubject(user.getUid()) // 토큰 용도
               .setIssuedAt(now) // 토큰 발행 시간 정보
               .setExpiration(new Date(now.getTime() + jwtExpmin)) // TOKEN 유효기간 설정
               .signWith(SignatureAlgorithm.HS256, jwtSecretKey)  // (암호화 알고리즘, secret값)
               .compact();
       }
       
       // JWT Token 으로 User조회
       public String getUser(String Token) {
           return Jwts.parser().setSigningKey(jwtSecretKey).parseClaimsJws(Token).getBody().getSubject();
       }
       
   }
   ```

   * 여기서 Spring Boot 버전이 2.3 이상이라 @Valid에서 오류가 발생하였다. 이때는 pom.xml에 dependency를 추가해주면 해결된다.

     ```xml
     <dependency>
         <groupId>org.springframework.boot</groupId>
         <artifactId>spring-boot-starter-validation</artifactId>
     </dependency>
     ```

     



##### 사용 - AccountController.java

```java
import com.example.backend.security.JwtTokenProvider;
import com.example.backend.security.JwtAuthentication;

public class AccountController {
    @Autowired
    JwtTokenProvider tokenProvider;

    // Token 생성
    String jwt = tokenProvider.createToken(user);
    result = new JwtAuthentication(jwt);
    return result
    
    ...    
    
    // Token으로 회원 정보 조회 (uid 얻어오기)
    String userId = tokenProvider.getUser(Token);
    
}
```

